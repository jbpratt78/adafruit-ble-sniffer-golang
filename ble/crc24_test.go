package ble

import "testing"

var crcTests = []struct {
	data []byte
	crc  uint32
}{
	{[]byte{0x00, 0x17, 0x7e, 0x01, 0x00, 0xd0, 0x22, 0x00, 0x02, 0x01, 0x06, 0x03, 0x02, 0x0d, 0x18, 0x06, 0xff, 0x6b, 0x00, 0x03, 0x16, 0x52, 0x02, 0x0a, 0x00}, 0x9209f4},
	{[]byte{0x00, 0x17, 0x7e, 0x01, 0x00, 0xd0, 0x22, 0x00, 0x02, 0x01, 0x06, 0x03, 0x02, 0x0d, 0x18, 0x06, 0xff, 0x6b, 0x00, 0x03, 0x16, 0x54, 0x02, 0x0a, 0x00}, 0x145f95},
	{[]byte{0x00, 0x17, 0x7e, 0x01, 0x00, 0xd0, 0x22, 0x00, 0x02, 0x01, 0x06, 0x03, 0x02, 0x0d, 0x18, 0x06, 0xff, 0x6b, 0x00, 0x03, 0x16, 0x55, 0x02, 0x0a, 0x00}, 0x636685},
}

// https://github.com/edrosten/bluez/blob/4094afd1a9ace5e35a6237e9d321589651538447/unit/test-crc.c
func TestAdvCRC2424(t *testing.T) {
	for _, test := range crcTests {
		if Crc24(0, test.data) != Crc24ByLut(0, test.data) {
			t.Error("should produce the same CRC value")
		}
	}

	for _, test := range crcTests {
		actual := AdvCrc24(test.data)
		if actual != test.crc {
			t.Errorf("AdvCrc24(%#v) = %x, want %x", test.data, actual, test.crc)
		}
	}
}

func BenchmarkCrc24(b *testing.B) {
	for i := 0; i < b.N; i++ {
		Crc24(0, crcTests[0].data)
	}
}

func BenchmarkCrc24ByLut(b *testing.B) {
	for i := 0; i < b.N; i++ {
		Crc24ByLut(0, crcTests[0].data)
	}
}
